require('dotenv').load();
const mailer = require('../helper/mailer');
const kue = require('kue'),
  queue   = kue.createQueue();

console.log("Starting server");
queue.process('email',(job,done)=>{
  console.log(job.data);
  mailer
    .prepareContext(job.data)
    .then(mailer.prepareBody)
    .then(mailer.prepareMail)
    .then(mailer.sendMail)
    .then((data)=>{
      console.log("Mail sent");
    })
    .catch((err)=>{
      console.log(err.message);
    });
});

queue.on('error',(err)=>{
  console.log(err);
});
